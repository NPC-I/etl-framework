{
  "column_mapping": {
    "order_id": "order_id",
    "customer_name": "customer_name",
    "door_width": "door_width",
    "door_height": "door_height",
    "material": "material",
    "quantity": "quantity",
    "unit_price": "unit_price",
    "order_date": "order_date"
  },
  "business_rules": {
    "material_prices": {
      "AL": 120.0,
      "ST": 180.0,
      "WO": 250.0
    },
    "installation_rates": {
      "small": 100.0,
      "medium": 150.0,
      "large": 200.0
    },
    "tax_rate": 0.2,
    "profit_margin": 1.3,
    "warranty_years": 5
  },
  "calculations": [
    {
      "name": "area_sq_units",
      "formula": "door_width * door_height",
      "description": "Calculate door area"
    },
    {
      "name": "size_category",
      "formula": "pd.cut(area_sq_units, bins=[0, 5000000, 10000000, float('inf')], labels=['small', 'medium', 'large'])",
      "description": "Categorize by size"
    },
    {
      "name": "material_cost",
      "lookup": "material_prices[material]",
      "description": "Get material price",
      "condition": "has:material"
    },
    {
      "name": "installation_cost",
      "lookup": "installation_rates[size_category]",
      "description": "Get installation cost",
      "condition": "has:size_category"
    },
    {
      "name": "material_total",
      "formula": "area_sq_units * material_cost",
      "description": "Total material cost",
      "condition": "has:material_cost"
    },
    {
      "name": "production_cost",
      "formula": "material_total + installation_cost",
      "description": "Total production cost",
      "condition": "has:material_total"
    },
    {
      "name": "sale_price_before_tax",
      "formula": "production_cost * profit_margin",
      "description": "Sale price before tax",
      "condition": "has:production_cost"
    },
    {
      "name": "tax_amount",
      "formula": "sale_price_before_tax * tax_rate",
      "description": "Tax amount",
      "condition": "has:sale_price_before_tax"
    },
    {
      "name": "total_price",
      "formula": "sale_price_before_tax + tax_amount",
      "description": "Total price including tax",
      "condition": "has:sale_price_before_tax"
    },
    {
      "name": "warranty_end_date",
      "formula": "order_date + pd.DateOffset(years=warranty_years)",
      "description": "Warranty end date",
      "condition": "has:order_date"
    },
    {
      "name": "profit_margin_percentage",
      "formula": "(profit_margin - 1) * 100",
      "description": "Profit margin as percentage"
    }
  ],
  "loading_strategy": {
    "strategy": "upsert",
    "key_columns": [
      "order_id"
    ],
    "batch_size": 1000,
    "create_index": true,
    "drop_duplicates": true
  }
}
